--- arch/powerpc/kernel/iommu.c	2012-06-08 09:01:02.785709100 +1000
+++ arch/powerpc/kernel/iommu.c	2012-06-08 09:01:07.489784856 +1000
@@ -33,7 +33,9 @@
 #include <linux/bitmap.h>
 #include <linux/iommu-helper.h>
 #include <linux/crash_dump.h>
+#include <linux/fault-inject.h>
 #include <asm/io.h>
+#include <asm/vio.h>
 #include <asm/prom.h>
 #include <asm/iommu.h>
 #include <asm/pci-bridge.h>
@@ -171,6 +261,9 @@
 		return DMA_ERROR_CODE;
 	}
 
+	if (should_fail_iommu(dev))
+		return DMA_ERROR_CODE;
+
 	if (handle && *handle)
 		start = *handle;
 	else
